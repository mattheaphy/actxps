<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="actxps">
<title>Data visualizations • actxps</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data visualizations">
<meta property="og:description" content="actxps">
<meta property="og:image" content="https://mattheaphy.github.io/actxps/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">actxps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/actxps.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/exposures.html">Exposure calculations</a>
    <a class="dropdown-item" href="../articles/exp_summary.html">Experience summaries</a>
    <a class="dropdown-item" href="../articles/transactions.html">Transaction studies</a>
    <a class="dropdown-item" href="../articles/visualizations.html">Data visualizations</a>
    <a class="dropdown-item" href="../articles/misc.html">Other functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mattheaphy/actxps/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data visualizations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mattheaphy/actxps/blob/HEAD/vignettes/articles/visualizations.Rmd" class="external-link"><code>vignettes/articles/visualizations.Rmd</code></a></small>
      <div class="d-none name"><code>visualizations.Rmd</code></div>
    </div>

    
    
<p>This article describes the data visualization functions available in
the actxps package.</p>
<ul>
<li><p>The <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> function uses the
<code>ggplot2</code> package to create plots of termination study
results (<code>exp_df</code> objects<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;exp_df&lt;/code&gt; objects are created by
&lt;code&gt;&lt;a href="../reference/exp_stats.html"&gt;exp_stats()&lt;/a&gt;&lt;/code&gt; see &lt;code&gt;&lt;a href="../articles/exp_summary.html"&gt;vignette("exp_summary")&lt;/a&gt;&lt;/code&gt; for
more information&lt;/p&gt;'><sup>1</sup></a>) or transaction study results
(<code>trx_df</code> objects<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;trx_df&lt;/code&gt; objects are created by
&lt;code&gt;&lt;a href="../reference/trx_stats.html"&gt;trx_stats()&lt;/a&gt;&lt;/code&gt; see &lt;code&gt;&lt;a href="../articles/transactions.html"&gt;vignette("transactions")&lt;/a&gt;&lt;/code&gt; for
more information&lt;/p&gt;'><sup>2</sup></a>).</p></li>
<li>
<p>Additional plotting functions create special plots that are not
possible or difficult to produce using <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code>.</p>
<ul>
<li>
<code><a href="../reference/plot_special.html">plot_termination_rates()</a></code> produces plots of observed
termination rates alongside expected termination rates.</li>
<li>
<code><a href="../reference/plot_special.html">plot_actual_to_expected()</a></code> draws a plot of all
actual-to-expected termination rates.</li>
<li>
<code><a href="../reference/plot_special_trx.html">plot_utilization_rates()</a></code> creates a side-by-side plot of
transaction frequency and severity.</li>
</ul>
</li>
<li><p>The <code><a href="../reference/autotable.html">autotable()</a></code> function uses the <code>gt</code>
package to create HTML tables of termination study or transaction study
results.</p></li>
<li><p>The <code><a href="../reference/exp_shiny.html">exp_shiny()</a></code> function launches a Shiny app that
includes interactive filters, grouping variables, and data
visualizations.</p></li>
</ul>
<div class="section level2">
<h2 id="plotting-termination-studies">Plotting termination studies<a class="anchor" aria-label="anchor" href="#plotting-termination-studies"></a>
</h2>
<p>Before we start plotting, we need to create experience study data.
The examples below use the simulated <code>census_dat</code> and
<code>withdrawals</code> data sets that come with the actxps package.
First, exposure records are created using <code><a href="../reference/expose.html">expose()</a></code>. Then,
illustrative expected values and withdrawal transactions are added to
the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mattheaphy/actxps/" class="external-link">actxps</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create exposure records</span></span>
<span><span class="va">exposed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expose.html">expose</a></span><span class="op">(</span><span class="va">census_dat</span>, end_date <span class="op">=</span> <span class="st">"2019-12-31"</span>,</span>
<span>                       target_status <span class="op">=</span> <span class="st">"Surrender"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add expected values</span></span>
<span><span class="va">expected_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.005</span>, <span class="fl">0.03</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposed_data</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expected_1 <span class="op">=</span> <span class="va">expected_table</span><span class="op">[</span><span class="va">pol_yr</span><span class="op">]</span>,</span>
<span>         expected_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">exposed_data</span><span class="op">$</span><span class="va">inc_guar</span>, <span class="fl">0.015</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add transactions</span></span>
<span>  <span class="fu"><a href="../reference/add_transactions.html">add_transactions</a></span><span class="op">(</span><span class="va">withdrawals</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="autoplot-exp_df">
<code>autoplot.exp_df</code><a class="anchor" aria-label="anchor" href="#autoplot-exp_df"></a>
</h3>
<p>The actxps package provides an <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> method for
<code>exp_df</code> objects. Throughout this vignette, the method name
<code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> will be used to distinguish this method
from the generic <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> function.</p>
<p>Below, an <code>exp_df</code> object is created using
<code><a href="../reference/exp_stats.html">exp_stats()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exp_stats.html">exp_stats</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The default plot produced by <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> is a line
plot of the observed termination rate (<code>q_obs</code>). The
<code>x</code> variable corresponds to the first grouping variable of
the <code>exp_df</code> object<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If there are no grouping variables, a single point is
plotted&lt;/p&gt;"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-basic-1.png" width="576"></p>
<p>If there is a second grouping variable, it is mapped onto color.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span>, <span class="va">inc_guar</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exp_stats.html">exp_stats</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-color-1.png" width="576"></p>
<p>Any additional grouping variables beyond two are used to create
facets.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_res2</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span>, <span class="va">product</span>, <span class="va">inc_guar</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exp_stats.html">exp_stats</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res2</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-facets-1.png" width="576"></p>
<p><strong><code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> arguments</strong></p>
<p>There are two ways of overriding the default aesthetics selected by
<code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>.</p>
<ol style="list-style-type: decimal">
<li>The <code>x</code>, <code>y</code>, <code>color</code>, and
<code>...</code> arguments can be passed unquoted column names or
expressions to use as the x, y, color / fill, and faceting variables,
respectively.</li>
<li>The <code>mapping</code> argument can be passed an aesthetic mapping
using <code><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">ggplot2::aes()</a></code>. If this argument is supplied, the
<code>x</code>, <code>y</code>, and <code>color</code> arguments are
ignored.</li>
</ol>
<p>Let’s assume we want to plot the number of claims instead of the
termination rate, and we want <code>inc_guar</code> to be the color
variable instead of <code>product</code>.</p>
<p>Using the <code>y</code>, <code>color</code>, and <code>...</code>
arguments, we could write:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res2</span>, y <span class="op">=</span> <span class="va">claims</span>, color <span class="op">=</span> <span class="va">inc_guar</span>, <span class="va">product</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-alt-map-1-1.png" width="576"></p>
<p>Alternatively, we could supply a mapping for more fine-grained
control. Note that the example below adds an additional mapping for
<code>linetype</code> which is otherwise unavailable under the defaults
for <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res2</span>, </span>
<span>         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pol_yr</span>, y <span class="op">=</span> <span class="va">claims</span>, color <span class="op">=</span> <span class="va">inc_guar</span>,</span>
<span>                       linetype <span class="op">=</span> <span class="va">inc_guar</span><span class="op">)</span>, </span>
<span>         <span class="va">product</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-alt-map-2-1.png" width="576"></p>
<p>The <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> function defaults to percentages
for y-axis labels. As seen in the immediately preceding example, this
will not always be appropriate. The <code>y_labels</code> function can
be used to pass a different labeling function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res2</span>, y <span class="op">=</span> <span class="va">claims</span>, color <span class="op">=</span> <span class="va">inc_guar</span>, <span class="va">product</span>,</span>
<span>         y_labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-y-label-1.png" width="576"></p>
<p>To set axis scales that vary by subplot, use the <code>scales</code>
argument. This argument is subsequently forwarded to
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code>. Under the default value “fixed”,
scales are identical across subplots. If “free_y” is passed as shown
below, the y-scales will vary. If “free_x” is passed, the x-scales will
vary. If “free” is passed, both the x- and y-scales will vary.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res2</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-facet-free-1.png" width="576"></p>
<p>The <code>geoms</code> argument can be used to change the plotting
geometry. Under the default value of “lines”, points and lines are
displayed. If “bars” is passed, a bar plot will be drawn.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res</span>, geoms <span class="op">=</span> <span class="st">"bars"</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-bar-1.png" width="576"></p>
<p>If the <code>y_log10</code> argument is set to <code>TRUE</code>, the
y-axis will be plotting on a logarithmic base ten scale.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res</span>, y_log10 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-log10-1.png" width="576"></p>
<p><code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> contains a handful of arguments for
plotting an additional variable on the y-axis. This variable defaults to
exposures and will always use an area geometry.</p>
<ul>
<li>To add a second y-axis, set <code>second_axis</code> to
<code>TRUE</code>.</li>
<li>The <code>second_y</code> argument specifies which variable is
plotted on the second y-axis.</li>
<li>The <code>second_y_labels</code> argument is used to change the
labels on the second y-axis. Since exposures are the default second
y-axis variable, labels are defaulted to a whole number comma
format.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">exp_res</span>, second_axis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-second-y-axis-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="plot_termination_rates">
<code>plot_termination_rates()</code><a class="anchor" aria-label="anchor" href="#plot_termination_rates"></a>
</h3>
<p>A limitation of <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> is that it doesn’t
allow one to plot observed termination rates alongside one or more
expected termination rates. This type of plot is common as an
alternative to actual-to-expected ratio plots.</p>
<p>The <code><a href="../reference/plot_special.html">plot_termination_rates()</a></code> function produces a plot of
the observed termination rates plus any expected termination rates that
were passed to the <code>expected</code> argument of
<code><a href="../reference/exp_stats.html">exp_stats()</a></code>.</p>
<p>In the example below, a new <code>exp_df</code> object is created
that contains two sets of expected surrender rates. This object is then
passed into <code><a href="../reference/plot_special.html">plot_termination_rates()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">exp_res3</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exp_stats.html">exp_stats</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"expected_1"</span>, <span class="st">"expected_2"</span><span class="op">)</span>, credibility <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_special.html">plot_termination_rates</a></span><span class="op">(</span><span class="va">exp_res3</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-term-1-1.png" width="576"></p>
<p>In the plot above, termination rates are mapped to the <code>y</code>
variable and the <code>Series</code> variable specifies a color scale.
Similar to <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>, the <code>x</code> variable
is the first grouping variable (here, <code>pol_yr</code>).</p>
<p>If the <code>exp_df</code> object contains credibility-weighted
termination rates<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See the &lt;code&gt;credibility&lt;/code&gt; argument of
&lt;code&gt;&lt;a href="../reference/exp_stats.html"&gt;exp_stats()&lt;/a&gt;&lt;/code&gt; for more information&lt;/p&gt;'><sup>4</sup></a>, these rates can be included in the plot
using the argument <code>include_cred_adj = TRUE</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_special.html">plot_termination_rates</a></span><span class="op">(</span><span class="va">exp_res3</span>, include_cred_adj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-term-2-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="plot_actual_to_expected">
<code>plot_actual_to_expected()</code><a class="anchor" aria-label="anchor" href="#plot_actual_to_expected"></a>
</h3>
<p>The <code><a href="../reference/plot_special.html">plot_actual_to_expected()</a></code> function is similar to
<code><a href="../reference/plot_special.html">plot_termination_rates()</a></code> except that all actual-to-expected
ratios are plotted on the y-axis instead.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_special.html">plot_actual_to_expected</a></span><span class="op">(</span><span class="va">exp_res3</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/plot-ae-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="relationship-of-plot_termination_rates-and-plot_actual_to_expected-to-autoplot-exp_df">Relationship of <code>plot_termination_rates()</code> and
<code>plot_actual_to_expected()</code> to
<code>autoplot.exp_df()</code><a class="anchor" aria-label="anchor" href="#relationship-of-plot_termination_rates-and-plot_actual_to_expected-to-autoplot-exp_df"></a>
</h3>
<p>Behind the scenes, <code><a href="../reference/plot_special.html">plot_termination_rates()</a></code> and
<code><a href="../reference/plot_special.html">plot_actual_to_expected()</a></code> call <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code>
after reshaping the <code>exp_df</code> object. As such, all arguments
passed to <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> described above can also be
passed to these functions. However, there is an exception: the
<code>y</code> variable is reserved and cannot be modified. In addition,
while the <code>color</code> variable can be overridden, this is
discouraged because it may result in odd-looking plots.</p>
<p>Since these functions automatically create a color variable, any
grouping variables beyond the <em>first</em> are used to create facets.
This differs from <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code> which uses grouping
variables beyond the <em>second</em> to create facets</p>
</div>
</div>
<div class="section level2">
<h2 id="plotting-transaction-studies">Plotting transaction studies<a class="anchor" aria-label="anchor" href="#plotting-transaction-studies"></a>
</h2>
<p>The actxps package also provides an <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> method
for <code>trx_df</code> objects. The <code><a href="../reference/autoplot_exp.html">autoplot.trx_df()</a></code>
method has the same arguments as <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>, so all
options described in the previous section can be used for transaction
studies as well.</p>
<p>The y variable defaults to the observed transaction frequency
(<code>trx_util</code>). Like <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>, any
numeric column can be mapped onto the y-axis using the <code>y</code> or
<code>mapping</code> arguments.</p>
<p>Under the defaults, <code><a href="../reference/autoplot_exp.html">autoplot.trx_df()</a></code> handles grouping
variables the same as <code><a href="../reference/autoplot_exp.html">autoplot.exp_df()</a></code>:</p>
<ul>
<li>The first grouping variable is mapped onto <code>x</code>
</li>
<li>The second grouping variable is mapped onto color</li>
<li>Any additional grouping variables are used to create subplots</li>
</ul>
<p>In addition to the above, facets are also created for each
transaction type found in the data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trx_res</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span>, <span class="va">inc_guar</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/trx_stats.html">trx_stats</a></span><span class="op">(</span>percent_of <span class="op">=</span> <span class="st">"premium"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trx_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pct_of_premium_all</span>, second_axis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/trx-plot-1.png" width="576"></p>
<div class="section level3">
<h3 id="plot_utilization_rates">
<code>plot_utilization_rates()</code><a class="anchor" aria-label="anchor" href="#plot_utilization_rates"></a>
</h3>
<p>The <code><a href="../reference/plot_special_trx.html">plot_utilization_rates()</a></code> function can be used to
create a side-by-side view of both transaction frequency and severity.
This type of plot is useful for answering questions like, <em>“what
percentage of customers are taking withdrawals each quarter, and of
those taking withdrawals, what is the average percentage of account
value taken out?”</em>.</p>
<p>Transaction frequency is represented by utilization rates
(<code>trx_util</code>). Severity is represented by transaction amounts
as a percentage of one or more other columns in the data. All severity
series begin with the prefix <code>pct_of_</code> and end with the
suffix <code>_w_trx</code>. The suffix refers to the fact that the
denominator only includes records with non-zero transactions. Severity
series are automatically selected based on column names passed to the
<code>percent_of</code> argument in <code><a href="../reference/trx_stats.html">trx_stats()</a></code>. If no
“percentage of” columns exist, this function will only plot utilization
rates.</p>
<p>Like <code><a href="../reference/plot_special.html">plot_termination_rates()</a></code> and
<code><a href="../reference/plot_special.html">plot_actual_to_expected()</a></code>, this function calls
<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> after reshaping the data. All arguments passed
to <code><a href="../reference/autoplot_exp.html">autoplot.trx_df()</a></code> can be utilized by this function
except <code>y</code> and <code>scales</code>. The <code>y</code>
argument is reserved for utilization rates, and the <code>scales</code>
argument is preset to allow differing scales between the frequency and
severity subplots.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_special_trx.html">plot_utilization_rates</a></span><span class="op">(</span><span class="va">trx_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualizations_files/figure-html/trx-util-plot-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="tables">Tables<a class="anchor" aria-label="anchor" href="#tables"></a>
</h2>
<p>The <code><a href="../reference/autotable.html">autotable()</a></code> function creates summary tables of
termination or transaction study results. This function is a generic
function with methods specific to <code>exp_df</code> and
<code>trx_df</code> objects.</p>
<div class="section level3">
<h3 id="termination-study-output-example">Termination study output example<a class="anchor" aria-label="anchor" href="#termination-study-output-example"></a>
</h3>
<center>
<img src="../reference/figures/exp_gt.png" width="55%" height="55%">
</center>
</div>
<div class="section level3">
<h3 id="transaction-study-output-example">Transaction study output example<a class="anchor" aria-label="anchor" href="#transaction-study-output-example"></a>
</h3>
<center>
<img src="../reference/figures/trx_gt.png" width="65%" height="65%">
</center>
<p><strong>Arguments</strong>:</p>
<ul>
<li><p><code>fontsize</code> is a multiple that can be used to increase
or decrease the font size. Values less than 100 decrease the font size,
and values greater than 100 increase the font size.</p></li>
<li><p><code>decimals</code> controls the number of decimal places
displayed for percentage columns (default = 1)</p></li>
<li>
<p>If <code>colorful</code> is <code>TRUE</code>, conditional color
formatting will be added to the table.</p>
<ul>
<li>For termination studies, <code>color_q_obs</code> and
<code>color_ae_</code> specify the color palettes used for observed
termination rates and actual-to-expected ratios, respectively.</li>
<li>For transaction studies, <code>color_util</code> and
<code>color_pct_of</code> specify the color palettes used for
utilization rates and “percentage of” columns, respectively.</li>
</ul>
<p>These inputs must be strings referencing a discrete color palette
available in the <code>paletteer</code> package. Palettes must be in the
form “package::palette”. For a full list of available palettes, see
<code><a href="https://rdrr.io/pkg/paletteer/man/palettes_d_names.html" class="external-link">paletteer::palettes_d_names</a></code>.</p>
</li>
<li><p><code>rename_cols</code> can be used to relabel columns. This
input must be a named list or character vector with names equal to
original column names and values equal to the desired column labels.
Most of the column names created by <code><a href="../reference/autotable.html">autotable()</a></code> are
presentation-ready, however, grouping variables on the left side of the
table may require updates since they default to the variable names that
appear in the data.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="interactive-shiny-app">Interactive Shiny app<a class="anchor" aria-label="anchor" href="#interactive-shiny-app"></a>
</h2>
<p><code><a href="../reference/exp_shiny.html">exp_shiny()</a></code> is a powerful function that launches an
interactive Shiny app containing filters, grouping variables, plots
produced by <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code>, tables produced by
<code><a href="../reference/autotable.html">autotable()</a></code>, and a data export button. This function
requires an <code>exposed_df</code> object<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See &lt;code&gt;&lt;a href="../reference/expose.html"&gt;expose()&lt;/a&gt;&lt;/code&gt; or
&lt;code&gt;&lt;a href="../reference/is_exposed_df.html"&gt;as_exposed_df()&lt;/a&gt;&lt;/code&gt; for more information&lt;/p&gt;'><sup>5</sup></a>.</p>
<p>The left sidebar of the app contains filtering widgets for all
variables passed to the <code>predictors</code> argument. If
<code>predictors</code> is not specified, all columns in the data except
policy numbers, statuses, termination dates, exposures, and transaction
columns will be used. The type of widget will vary depending on the data
type and number of unique values of each predictor.</p>
<p>In the “Study options” box, grouping variables and study type options
are shown. Grouping variables are used to specify aesthetic elements for
the plot and groups for the table output. The study type section will
always include a section for termination studies. If transactions are
attached to the <code>exposed_df</code> object<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See &lt;code&gt;&lt;a href="../reference/add_transactions.html"&gt;add_transactions()&lt;/a&gt;&lt;/code&gt; for information on
attaching transactions to an &lt;code&gt;exposed_df&lt;/code&gt; object.&lt;/p&gt;'><sup>6</sup></a>, an additional section
will be displayed for transaction studies.</p>
<ul>
<li>Termination study options include the ability to activate and
deactivate expected values and the selection of an optional numeric
weighting variable for exposures. Expected values are dictated by the
<code>expected</code> argument. If this argument is not specified, any
columns containing the word “expected” are assumed to be expected
values.</li>
<li>Transaction study options include the ability to activate and
deactivate transaction types, optional numeric columns to use in
“percentage of” statistics, and an option to lump all transaction types
into a single category.</li>
</ul>
<p>The output section includes tabs for plots, tables, and exporting
data. The plot tab includes options for changing the plot’s
<code>y</code>-variable, adding a second axis, changing the geometry
type, adding a smoothing curve, and more.</p>
<p><img src="../reference/figures/exp_shiny.png" width="100%"></p>
<p><strong>Other arguments</strong></p>
<ul>
<li>
<code>distinct_max</code>: an upper limit on the number of distinct
values a variable is allowed to have to be included as a viable option
for the color and facets grouping variables. Default = 25.</li>
<li>
<code>title</code>: an optional title for the app</li>
<li>
<code>credibility</code>, <code>cred_p</code>, <code>cred_r</code>:
credibility options for termination studies. See
<code><a href="../reference/exp_stats.html">exp_stats()</a></code> for more information. Limited fluctuation
credibility estimates at a 95% confidence within 5% of the theoretical
mean assuming a binomial distribution are used as a default.</li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Heaphy.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7. Logo <a href="https://www.freepik.com/free-vector/shine-old-wooden-chest-realistic-composition-transparent-background-with-vintage-coffer-sparkling-particles_7497397.htm#query=treasure&amp;position=7&amp;from_view=search&amp;track=sph" class="external-link">image by macrovector</a> on Freepik</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
