<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="actxps">
<title>Other functions • actxps</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Other functions">
<meta property="og:description" content="actxps">
<meta property="og:image" content="https://mattheaphy.github.io/actxps/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">actxps</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/actxps.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/exposures.html">Exposure calculations</a>
    <a class="dropdown-item" href="../articles/exp_summary.html">Experience summaries</a>
    <a class="dropdown-item" href="../articles/transactions.html">Transaction studies</a>
    <a class="dropdown-item" href="../articles/visualizations.html">Data visualizations</a>
    <a class="dropdown-item" href="../articles/misc.html">Other functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mattheaphy/actxps/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Other functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mattheaphy/actxps/blob/HEAD/vignettes/misc.Rmd" class="external-link"><code>vignettes/misc.Rmd</code></a></small>
      <div class="d-none name"><code>misc.Rmd</code></div>
    </div>

    
    
<p>This vignette features functions that are not covered in other
vignettes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mattheaphy/actxps/" class="external-link">actxps</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'actxps'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="working-with-aggregate-experience-data">Working with aggregate experience data<a class="anchor" aria-label="anchor" href="#working-with-aggregate-experience-data"></a>
</h2>
<p>Seriatim-level policy experience data is often not available for
analysis. This is almost always the case with industry studies that
contain experience data submitted by multiple parties. In these cases,
experience is grouped by a several common policy attributes and
aggregated accordingly.</p>
<p>The typical workflow in actxps of
<code>expose() |&gt; exp_stats()</code> for termination studies or
<code>expose() |&gt; add_transactions() |&gt; trx_stats()</code> for
transaction studies doesn’t apply if the starting data is aggregated.
That is because another party has already gone through the steps of
creating exposure records and performing an initial level of
aggregation.</p>
<p>Actxps provides two functions designed to work with aggregate
experience data.</p>
<ul>
<li>For termination studies, <code><a href="../reference/as_exp_df.html">as_exp_df()</a></code> converts a data
frame of aggregate experience into an <code>exp_df</code> object, which
is the class returned by <code><a href="../reference/exp_stats.html">exp_stats()</a></code> = For transaction
studies, <code><a href="../reference/as_trx_df.html">as_trx_df()</a></code> converts a data frame of aggregate
experience into a <code>trx_df</code> object, which is the class
returned by <code><a href="../reference/trx_stats.html">trx_stats()</a></code>
</li>
</ul>
<p>Both object classes have a <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method which
summarizes experience across any grouping variables passed to the
function. The output of <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> will always be another
<code>exp_df</code> (or <code>trx_df</code>) object, and will look just
like the results of <code><a href="../reference/exp_stats.html">exp_stats()</a></code> (or
<code><a href="../reference/trx_stats.html">trx_stats()</a></code>). For downstream reporting, summary results can
be passed to the visualization functions <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> and
<code><a href="../reference/autotable.html">autotable()</a></code>.</p>
<p>The <code>agg_sim_dat</code> data set contains aggregate experience
on a theoretical block of deferred annuity contracts. Below,
<code><a href="../reference/as_exp_df.html">as_exp_df()</a></code> is used to convert the data to an
<code>exp_df</code>, and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> is called using multiple
grouping variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_sim_exp_df</span> <span class="op">&lt;-</span> <span class="va">agg_sim_dat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_exp_df.html">as_exp_df</a></span><span class="op">(</span>col_exposure <span class="op">=</span> <span class="st">"exposure_n"</span>, col_claims <span class="op">=</span> <span class="st">"claims_n"</span>,</span>
<span>            conf_int <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            start_date <span class="op">=</span> <span class="fl">2005</span>, end_date <span class="op">=</span> <span class="fl">2019</span>, target_status <span class="op">=</span> <span class="st">"Surrender"</span><span class="op">)</span></span></code></pre></div>
<p>Results summarized by policy year</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">agg_sim_exp_df</span>, <span class="va">pol_yr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Experience study results</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Groups: pol_yr </span></span>
<span><span class="co">#&gt;  Target status: Surrender </span></span>
<span><span class="co">#&gt;  Study range: 2005 to 2019 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 7</span></span></span>
<span><span class="co">#&gt;    pol_yr n_claims claims exposure   q_obs q_obs_lower q_obs_upper</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1      102    102   <span style="text-decoration: underline;">19</span>252. 0.005<span style="text-decoration: underline;">30</span>     0.004<span style="text-decoration: underline;">31</span>     0.006<span style="text-decoration: underline;">34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      2      160    160   <span style="text-decoration: underline;">17</span>715. 0.009<span style="text-decoration: underline;">03</span>     0.007<span style="text-decoration: underline;">68</span>     0.010<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      3      124    124   <span style="text-decoration: underline;">16</span>097. 0.007<span style="text-decoration: underline;">70</span>     0.006<span style="text-decoration: underline;">40</span>     0.009<span style="text-decoration: underline;">07</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      4      168    168   <span style="text-decoration: underline;">14</span>536. 0.011<span style="text-decoration: underline;">6</span>      0.009<span style="text-decoration: underline;">84</span>     0.013<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      5      164    164   <span style="text-decoration: underline;">12</span>916. 0.012<span style="text-decoration: underline;">7</span>      0.010<span style="text-decoration: underline;">8</span>      0.014<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      6      152    152   <span style="text-decoration: underline;">11</span>376. 0.013<span style="text-decoration: underline;">4</span>      0.011<span style="text-decoration: underline;">3</span>      0.015<span style="text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      7      164    164    <span style="text-decoration: underline;">9</span>917. 0.016<span style="text-decoration: underline;">5</span>      0.014<span style="text-decoration: underline;">1</span>      0.019<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      8      190    190    <span style="text-decoration: underline;">8</span>448. 0.022<span style="text-decoration: underline;">5</span>      0.019<span style="text-decoration: underline;">4</span>      0.025<span style="text-decoration: underline;">7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      9      181    181    <span style="text-decoration: underline;">6</span>960. 0.026<span style="text-decoration: underline;">0</span>      0.022<span style="text-decoration: underline;">3</span>      0.029<span style="text-decoration: underline;">7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     10      152    152    <span style="text-decoration: underline;">5</span>604. 0.027<span style="text-decoration: underline;">1</span>      0.023<span style="text-decoration: underline;">0</span>      0.031<span style="text-decoration: underline;">4</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     11      804    804    <span style="text-decoration: underline;">4</span>390. 0.183       0.172       0.195  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     12      330    330    <span style="text-decoration: underline;">2</span>663. 0.124       0.112       0.137  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     13       99     99    <span style="text-decoration: underline;">1</span>620. 0.061<span style="text-decoration: underline;">1</span>      0.050<span style="text-decoration: underline;">0</span>      0.072<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     14       62     62     872. 0.071<span style="text-decoration: underline;">1</span>      0.055<span style="text-decoration: underline;">1</span>      0.088<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     15       17     17     268. 0.063<span style="text-decoration: underline;">4</span>      0.037<span style="text-decoration: underline;">3</span>      0.093<span style="text-decoration: underline;">2</span></span></span></code></pre></div>
<p>Results summarized by income guarantee presence and product</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">agg_sim_exp_df</span>, <span class="va">inc_guar</span>, <span class="va">product</span><span class="op">)</span></span>
<span><span class="co">#&gt; Experience study results</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Groups: inc_guar, product </span></span>
<span><span class="co">#&gt;  Target status: Surrender </span></span>
<span><span class="co">#&gt;  Study range: 2005 to 2019 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   inc_guar product n_claims claims exposure  q_obs q_obs_lower q_obs_upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> FALSE    a            449    449   <span style="text-decoration: underline;">12</span>738. 0.035<span style="text-decoration: underline;">2</span>      0.032<span style="text-decoration: underline;">1</span>      0.038<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> FALSE    b            392    392   <span style="text-decoration: underline;">13</span>490. 0.029<span style="text-decoration: underline;">1</span>      0.026<span style="text-decoration: underline;">2</span>      0.032<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> FALSE    c            760    760   <span style="text-decoration: underline;">25</span>895. 0.029<span style="text-decoration: underline;">3</span>      0.027<span style="text-decoration: underline;">3</span>      0.031<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> TRUE     a            361    361   <span style="text-decoration: underline;">19</span>966. 0.018<span style="text-decoration: underline;">1</span>      0.016<span style="text-decoration: underline;">3</span>      0.019<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRUE     b            273    273   <span style="text-decoration: underline;">19</span>694. 0.013<span style="text-decoration: underline;">9</span>      0.012<span style="text-decoration: underline;">2</span>      0.015<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRUE     c            634    634   <span style="text-decoration: underline;">40</span>851. 0.015<span style="text-decoration: underline;">5</span>      0.014<span style="text-decoration: underline;">3</span>      0.016<span style="text-decoration: underline;">7</span></span></span></code></pre></div>
<p><code><a href="../reference/as_exp_df.html">as_exp_df()</a></code> and <code><a href="../reference/as_trx_df.html">as_trx_df()</a></code> contain several
arguments for optional calculations like confidence intervals, expected
values, weighting variables, and more. These arguments mirror the
functionality in <code><a href="../reference/exp_stats.html">exp_stats()</a></code> and <code><a href="../reference/trx_stats.html">trx_stats()</a></code>.
Both functions also contain multiple arguments for specifying column
names associated with required values like exposures and claims.</p>
</div>
<div class="section level2">
<h2 id="policy-duration-functions">Policy duration functions<a class="anchor" aria-label="anchor" href="#policy-duration-functions"></a>
</h2>
<p>The <code>pol_()</code> family of functions calculates policy years,
months, quarters, weeks, or any other arbitrary duration. Each function
accepts a vector of dates and a vector of issue dates.</p>
<p><strong>Example</strong>: assume a policy was issued on 2022-05-10
and we are interested in calculating various policy duration values at
the end of calendar years 2022-2032.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-12-31"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># policy years</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_yr</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11</span></span>
<span></span>
<span><span class="co"># policy quarters</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_qtr</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  3  7 11 15 19 23 27 31 35 39 43</span></span>
<span></span>
<span><span class="co"># policy months</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_mth</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]   8  20  32  44  56  68  80  92 104 116 128</span></span>
<span></span>
<span><span class="co"># policy weeks</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_wk</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  34  86 139 191 243 295 347 399 452 504 556</span></span></code></pre></div>
<p>The more general <code><a href="../reference/pol_yr.html">pol_interval()</a></code> function calculates any
arbitrary duration. This function has a third argument where the length
of the policy duration can be specified. This argument must be a period
object. See <code><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">lubridate::period()</a></code> for more information.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># days</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_interval</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  236  601  967 1332 1697 2062 2428 2793 3158 3523 3889</span></span>
<span></span>
<span><span class="co"># fortnights</span></span>
<span><span class="fu"><a href="../reference/pol_yr.html">pol_interval</a></span><span class="op">(</span><span class="va">dates</span>, <span class="st">"2022-05-10"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">weeks</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  17  43  70  96 122 148 174 200 226 252 278</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="predictive-modeling-support-functions">Predictive modeling support functions<a class="anchor" aria-label="anchor" href="#predictive-modeling-support-functions"></a>
</h2>
<p>The <code><a href="../reference/add_predictions.html">add_predictions()</a></code> function attaches predictions from
any model with a <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method.</p>
<p>Below, a very simple logistic regression model is fit to surrender
experience in the first ten policy years. Predictions from this model
are then added to exposure records using <code><a href="../reference/add_predictions.html">add_predictions()</a></code>.
This function only requires a data frame of exposure records and a model
with a <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method. Often, it is necessary to specify
additional model-specific arguments like <code>type</code> to ensure
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> returns the desired output. In the example below,
<code>type</code> is set to “response” to return probabilities instead
of the default predictions on the log-odds scale.</p>
<p>The <code>col_expected</code> argument is used to rename the
column(s) containing predicted values. If no names are specified, the
default name is “expected”.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create exposure records</span></span>
<span><span class="va">exposed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expose.html">expose</a></span><span class="op">(</span><span class="va">census_dat</span>, end_date <span class="op">=</span> <span class="st">"2019-12-31"</span>,</span>
<span>                       target_status <span class="op">=</span> <span class="st">"Surrender"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pol_yr</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add a response column for surrenders</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>surrendered <span class="op">=</span> <span class="va">status</span> <span class="op">==</span> <span class="st">"Surrender"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a simple logistic model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">surrendered</span> <span class="op">~</span> <span class="va">pol_yr</span>, data <span class="op">=</span> <span class="va">exposed_data</span>, </span>
<span>           family <span class="op">=</span> <span class="st">"binomial"</span>, weights <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="va">exposed_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># attach predictions</span></span>
<span>  <span class="fu"><a href="../reference/add_predictions.html">add_predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span>, col_expected <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># summarize results</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pol_yr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/exp_stats.html">exp_stats</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># create a plot</span></span>
<span><span class="fu"><a href="../reference/plot_special.html">plot_termination_rates</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="misc_files/figure-html/add-preds-1.png" width="480"></p>
<p>In addition, for users of the tidymodels framework, the actxps
package includes a recipe step function, <code><a href="../reference/step_expose.html">step_expose()</a></code>,
that can apply the <code><a href="../reference/expose.html">expose()</a></code> function during data
preprocessing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'recipes'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     step</span></span>
<span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">census_dat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/step_expose.html">step_expose</a></span><span class="op">(</span>end_date <span class="op">=</span> <span class="st">"2019-12-31"</span>, target_status <span class="op">=</span> <span class="st">"Surrender"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Recipe</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; predictor: 11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Exposed data based on policy years for target status Surrender: <span style="color: #0000BB;">&lt;none&gt;</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Heaphy.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7. Logo <a href="https://www.freepik.com/free-vector/shine-old-wooden-chest-realistic-composition-transparent-background-with-vintage-coffer-sparkling-particles_7497397.htm#query=treasure&amp;position=7&amp;from_view=search&amp;track=sph" class="external-link">image by macrovector</a> on Freepik</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
